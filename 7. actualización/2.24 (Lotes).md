## 2.24
Una obra social lleva el control de los costos que le insume cada afiliado. Considerando como costos, los pagos
que la misma debe realizar (en conceptos de honorarios, pagos a farmacias, etc) por los distintos servicios que el
afiliado utiliza.

Para esto la empresa cuenta con un archivo CostosPorAfiliado, en el cual se registran la cantidad de atenciones y/o
servicios que solicita el empleado y el costo total (en pesos) que la empresa debe pagar por estos.
Este archivo está conformado por registros con el siguiente formato, y está ordenado Cod_Afiliado

**CostosPorAfiliado**
| Cod_afiliado | Fecha_alta | Fecha_baja | Cant_servicios | Costo |
|--------------|------------|------------|----------------|-------|

Cada viernes en la organización, se lleva a cabo un proceso de actualización del archivo costosPorAfiliados. Para
poder realizarlo se cuenta con un archivo ServiciosSemanales, ordenado por cod_afiliado y fecha_at, en el cual se
registran los servicios que solicitaron los afiliados durante cada semana. Cada registro de este archivo presenta el
siguiente formato,

**ServiciosSemanales**
| Cod_afiliado | Fecha_at | Cod-servicio | Costo |
|--------------|----------|--------------|-------|

En el archivo serviciosSemanales puede existir más de un registro por cada afiliado.
Para realizar el proceso de actualización se deben tener en cuenta las siguientes consideraciones.
- Si algún Cod_afiliado de serviciosSemanales, no se encuentra en ningún registro del archivo costoPorAfiliado,
y el primer Cod_servicio asociado al mismo es igual a 001 entonces se trata de un nuevo afiliado que fue dado de alta.
- Si Cod_afiliado de serviciosSemanales es igual al de costoPorAfiliados y el Cod_servicio es igual a 000 se
trata de un afiliado que fue dado de baja y se considera como fecha de baja el valor que reside en fecha_at.
Si en cambio, el Cod_servicio tiene algún otro valor este representa un servicio o atención que solicitó el
afiliado; por lo tanto deben contabilizarse la cantidad de servicios que solicitó; como así también los costos
que estos insumen.
- Si algún Cod_afiliado de costoPorAfiliados no se encuentra en el archivo serviciosSemanales, se trata de un
afiliado que no utilizó los servicios en la semana que se realiza la actualización.
- Cualquier otro caso distinto a los considerados anteriormente se toma como un error, y deben ser informados
por pantalla; indicando claramente el motivo del error.

```
ACCION ejercicio ES
  AMBIENTE
    HV = 999999

    Fecha = REGISTRO
      año: N(4)
      mes: 1..12
      dia: 1..31
    FIN_REGISTRO

    Costo = REGISTRO
      cod_afil: N(8)
      alta: Fecha
      baja: Fecha
      cant_serv: entero
      costo: real
    FIN_REGISTRO

    Servicio = REGISTO
      cod_afil: N(8)
      fecha_at: Fecha
      cod_serv: N(3)
      costo: real
    FIN_REGISTRO

    costosPorAfiliado, salida: archivo de Costo ordenado por cod_afil
    regmae, regsal, aux: Costo
    serviciosSemanales: archivo de Servicio ordenado por cod_afil, fecha_at
    regmov: Servicio

    PROCEDIMIENTO leer_costo() ES
      LEER(costosPorAfiliado, regmae)
      SI FDA(costosPorAfiliado) ENTONCES
        regmae.cod_afil := HV
      FIN_SI
    FIN_PROCEDIMIENTO

    PROCEDIMIENTO leer_servicio() ES
      LEER(serviciosSemanales, regmov)
      SI FDA(serviciosSemanales) ENTONCES
        regmov.cod_afil := HV
      FIN_SI
    FIN_PROCEDIMIENTO

    PROCEDIMIENTO actualizar_consumos() ES
      MIENTRAS regsal.cod_afil = regmov.cod_afil HACER
        SI regmov.cod_serv <> 000 ENTONCES
          regsal.cant_serv := regsal.cant_serv + 1
          regsal.costo := regsal.costo + regmov.costo
        CONTRARIO
          regsal.baja := regmov.fecha_at
        FIN_SI

        leer_servicio()
      FIN_MIENTRAS
    FIN_PROCEDIMIENTO
  PROCESO
    ABRIR E/ (costosPorAfiliado)
    ABRIR E/ (serviciosSemanales)
    ABRIR /S (salida)

    leer_costo()
    leer_servicio()

    MIENTRAS (regmae.cod_afil <> HV) O (regmov.cod_afil <> HV) HACER
      SI regmae.cod_afil < regmov.cod_afil ENTONCES

        regsal := regmae
        ESCRIBIR(salida, regsal)
        leer_costo()

      CONTRARIO

        SI regmae.cod_afil > regmov.cod_afil ENTONCES
          SI regmov.cod_serv = 001 ENTONCES
            regsal.cod_afil := regmov.cod_afil
            regsal.alta := regmov.fecha_at
            regsal.baja.año := 0000
            regsal.baja.mes := 11
            regsal.baja.dia := 1
            regsal.cant_serv := 1
            regsal.costo := regmov.costo

            leer_servicio()
            actualizar_consumos()
            ESCRIBIR(salida, regsal)
          CONTRARIO
            ESCRIBIR("ERROR: no se encontro el afiliado: ". regmov.cod_afil)
          FIN_SI

        CONTRARIO

          regsal := regmae
          actualizar_consumos() <- actualiza los valores o añade fecha de baja en caso de cod_serv = 000
          ESCRIBIR(salida, regsal)
          leer_costo()

        FIN_SI
      FIN_SI
    FIN_MIENTRAS

    CERRAR(costosPorAfiliado)
    CERRAR(serviciosSemanales)
    CERRAR(salida)
FIN_ACCION
```

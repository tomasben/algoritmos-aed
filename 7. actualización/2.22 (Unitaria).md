## 2.22
IDEM ejercicio 2.21 pero agregando al enunciado: “Al finalizar el proceso se desea conocer: el usuario que
posee más amigos.”

```
ACCION ejercicio ES
  AMBIENTE
    HV = 999999

    Fecha = REGISTRO
      año: N(4)
      mes: 1..12
      dia: 1..31
    FIN_REGISTRO

    Amigo = REGISTRO
      cod_usuario: N(8)
      cod_amigo: N(4)
      fecha_amistad: Fecha
      mensaje: AN(300)
    FIN_REGISTRO

    Notificación = REGISTRO
      cod_usuario: N(8)
      cod_amigo: N(4)
      cod_mov: ('A', 'B', 'M')
      fecha_amistad: Fecha
      mensaje: AN(300)
    FIN_REGISTRO

    amigos, salida: archivo de Amigo ordenado por cod_usuario, cod_amigo
    regmae, regsal: Amigo
    notificaciones: archivo de Notificación ordenado por cod_usuario, cod_amigo
    regmov: Notificación

    PROCEDIMIENTO leer_amigos() ES
      LEER(amigos, regmae)
      SI FDA(amigos) ENTONCES
        regmae.cod_usuario := HV
      FIN_SI
    FIN_PROCEDIMIENTO

    PROCEDIMIENTO leer_notificaciones() ES
      LEER(notificaciones, regmov)
      SI FDA(notificaciones) ENTONCES
        regmov.cod_usuario := HV
      FIN_SI
    FIN_PROCEDIMIENTO

    resg_cod_usuario, usuario_may_amigos: N(8)
    cant_amigos, may_amigos: entero

    PROCEDIMIENTO tratar_cantidad_amigos() ES
      SI resg_cod_usuario = regmae.cod_usuario ENTONCES
        cant_amigos := cant_amigos + 1
      CONTRARIO
        SI resg_cod_usuario <> HV ENTONCES
          SI cant_amigos > may_amigos ENTONCES
            may_amigos := cant_amigos
            usuario_may_amigos := resg_cod_usuario
          FIN_SI

          cant_amigos := 1
          resg_cod_usuario := regmae.cod_usuario
        FIN_SI
      FIN_SI
    FIN_PROCEDIMIENTO
  PROCESO
    ABRIR E/ (amigos)
    ABRIR E/ (notificaciones)
    ABRIR /S (salida)

    leer_amigos()
    leer_notificaciones()

    cant_amigos := 0; may_cant_amigos := 0
    resg_cod_usuario := regmae.cod_usuario

    MIENTRAS (regmae.cod_usuario <> HV) O (regmov.cod_usuario <> HV) HACER
      tratar_cantidad_amigos()

      SI regmae.cod_usuario < regmov.cod_usuario ENTONCES
        regsal := regmae
        ESCRIBIR(salida, regsal)
        leer_amigos()
      CONTRARIO
        SI regmae.cod_usuario > regmov.cod_usuario ENTONCES
          SEGUN regmov.cod_mov HACER
            'A': regsal.cod_usuario := regmov.cod_usuario
                 regsal.cod_amigo := regmov.cod_amigo
                 regsal.fecha_amistad := regmov.fecha_amistad
                 regsal.mensaje := regmov.mensaje
                 ESCRIBIR(salida, regsal)
            'B': ESCRIBIR("ERROR: No se puede dar de baja un amigo inexistente: ", regmov.cod_usuario)
            'M': ESCRIBIR("ERROR: No se puede añadir al muro de un amigo inexistente: ", regmov.cod_usuario)
          FIN_SEGUN
          leer_notificaciones()
        CONTRARIO
          SEGUN regmov.cod_mov HACER
            'A': ESCRIBIR("ERROR: amigo previamente añadido: ", regmov.cod_usuario)
            'B': ESCRIBIR("Amigo borrado")
            'M': regsal := regmae
                 regsal.mensaje := regmov.mensaje
                 ESCRIBIR(salida, regsal)
          FIN_SEGUN
          leer_amigos()
          leer_notificaciones()
        FIN_SI
      FIN_SI
    FIN_MIENTRAS

    ESCRIBIR("El usuario con la mayor cantidad de amigos fue el número ", usuario_may_amigos,
    " con un total de ", may_cant_amigos, " amigos.")

    CERRAR(amigos)
    CERRAR(notificaciones)
    CERRAR(salida)
FIN_ACCION
```
